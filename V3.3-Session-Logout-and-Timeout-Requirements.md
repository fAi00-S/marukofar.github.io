# V3.3 Session Logout and Timeout Requirements 

## Session คืออะไร?

**Session** คือ เป็นสิ่งที่ Client สร้างขึ้นมาเมื่อเปิดเว็บบราวเซอร์และติดต่อมายังเว็บเซิฟเวอร์ผ่านทาง URL ของเว็บไซต์ เมื่อ Client ทำการปิดโปรแกรมเว็บบราวเซอร์ Session ก็จะถูกทำลายหรือปิดลง ข้อมูลที่ถูกเก็บในตัวแปร Session จะถูกบันทึกเป็นไฟล์ Session เช่นเดียวกับไฟล์คุกกี้ แต่ Session จะเก็บไฟล์ไว้ที่ฝั่งเซิร์ฟเวอร์ อายุของ Session ถูกกำหนดด้วยการทำงานของเบราเซอร์ 

![](images/s1.png)

Ref: [https://code.tutsplus.com/tutorials/how-to-use-sessions-and-session-variables-in-php--cms-31839](https://code.tutsplus.com/tutorials/how-to-use-sessions-and-session-variables-in-php--cms-31839).

> **Session Timeout** ก็คือ Event ที่เกิดขึ้นเมื่อผู้ใช้ไม่ดำเนินการใด ๆ บนเว็บไซต์ในช่วงเวลาหนึ่ง (กำหนดโดยเว็บเซิร์ฟเวอร์) Event ในฝั่งเซิร์ฟเวอร์เปลี่ยนสถานะของ Session ผู้ใช้เป็น "invalid" (เช่น "ไม่ได้ใช้อีกต่อไป") และสั่งให้เว็บเซิร์ฟเวอร์ลบข้อมูลที่มีอยู่ในนั้นทั้งหมด

![](images/s2.jpg)

Ref: [https://community.microfocus.com/t5/ArcSight-User-Discussions/web-page-esm-session-time-out/td-p/1663776](https://community.microfocus.com/t5/ArcSight-User-Discussions/web-page-esm-session-time-out/td-p/1663776).

## ผลกระทบของ Session Timeout ในด้าน Security และแนวทางการรับมือ

Session Timeout จะเป็นตัวกำหนดเวลาหน้าต่าง Event ที่ดำเนินการต่างๆ ของผู้ใช้งานเว็บไซต์นั้นๆ และหน้าต่างนี้ยังแสดงถึงเวลาที่แฮกเกอร์สามารถเข้ามาขโมย Session และใช้ Session ของผู้ใช้ที่มีอยู่ได้  

####  แนวทางการรับมือที่ดีที่สุด คือ:

-  ตั้งค่า Session Timeout เป็นค่าต่ำสุดที่เท่าที่จะเป็นไปได้ขึ้นอยู่กับบริบทของแอปพลิเคชัน.
-  หลีกเลี่ยงการกำหนด  Session Timeout แบบไม่สิ้นสุด หรือ infinite
-  ต้องการการยืนยันในเรื่องของ Session Timeout ของแต่ละช่วง เพื่อที่จะประยุกต์ใช้กับการกำจัดเวลาภาพรวม (ทั้งหมด) สำหรับ Session ของแอปพลิเคชันทุกช่วง
-  ติดตามการสร้าง / ทำลาย Session เพื่อวิเคราะห์แนวโน้มการสร้างและพยายามตรวจหาจำนวนการสร้าง Session ตามปกติ ( Phase ของการทำโปรไฟล์แอปพลิเคชันในการโจมตี)

## Session Logout and Timeout Requirements

Session Timeout สอดคล้องกับ NIST 800-63 ซึ่งอนุญาตให้ Session Timeout นานกว่าที่มาตรฐานความปลอดภัยอนุญาต องค์กรควรตรวจสอบตารางด้านล่างและหากต้องการให้เวลาออกไปนานกว่านั้นขึ้นอยู่กับความเสี่ยงของแอปพลิเคชันค่า NIST ควรเป็นขอบเขตบนสุดของการหมดเวลาของเซสชัน
L1 ในบริบทนี้คือ IAL1 / AAL1, L2 คือ IAL2 / AAL3, L3 คือ IAL3 / AAL3 สำหรับ IAL2 / AAL2 และ IAL3 / AAL3 Session Timeout ที่สั้นกว่าคือขอบเขตล่างของเวลาว่างสำหรับการออกจากระบบหรือการพิสูจน์ตัวตนอีกครั้งเพื่อเริ่ม Session ต่อ

| # |     รายละเอียด    |  L1 | L2 | L3 | CWE | NIST | 
| -- |     ---------   | -- | -- | -- | ----- | ----- |
| 3.3.1 | ตรวจสอบว่าการออกจากระบบและการหมดอายุทำให้ Token ของเซสชันเป็นโมฆะ เช่น ปุ่ม back หรือฝั่งที่พึ่งพา Downstream ไม่กลับมาใช้ Session ที่ได้รับการรับรองความถูกต้องรวมถึงข้ามฝั่ง. (C6)| ✓ | ✓ | ✓ | 613| 7.1| 
| 3.3.2 | หากผู้รับรองความถูกต้องอนุญาตยังคงให้ผู้ใช้ยังคงล็อกอินค้างอยู่ ให้ตรวจสอบว่าการพิสูจน์ตัวตนซ้ำอีกครั้งเป็นระยะ ๆ ทั้งเมื่อใช้งานอยู่หรือหลังจากช่วงที่ไม่มีการใช้งาน (C6)| 30 days | 12 hr./ 30 min of inactivity, 2FA optional | 12 hr./ 15 min of inactivity, 2FA optional | 613| 7.2| 
| 3.3.3 | ตรวจสอบว่าแอปพลิเคชันให้ตัวเลือกในการยุติ Session ที่ใช้งานอื่น ๆ ทั้งหมดหลังจากเปลี่ยนรหัสผ่านสำเร็จหรือไม่ (รวมถึงการเปลี่ยนผ่านการรีเซ็ต / กู้คืนรหัสผ่าน) และมีผลกับแอปพลิเคชันการเข้าสู่ระบบแบบรวมศูนย์ (ถ้ามี) และบุคคลที่ต้องพึ่งพา|  | ✓ | ✓ | 613| | 
| 3.3.4 | ตรวจสอบว่าผู้ใช้สามารถดูและ (มีข้อมูลรับรองการเข้าสู่ระบบที่ป้อนซ้ำ) ออกจากระบบ Session และอุปกรณ์ใด ๆ หรือทั้งหมดที่ใช้งานอยู่ในปัจจุบัน |  | ✓ | ✓ | 613| 7.1 |

